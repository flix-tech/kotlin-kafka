<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>KotlinKafka</title>
<link href="images/logo-icon.svg" rel="icon" type="image/svg"><script>var pathToRoot = "";</script><script type="text/javascript" src="scripts/sourceset_dependencies.js" async="async"></script><link href="styles/style.css" rel="Stylesheet"><link href="styles/logo-styles.css" rel="Stylesheet"><link href="styles/jetbrains-mono.css" rel="Stylesheet"><link href="styles/main.css" rel="Stylesheet"><script type="text/javascript" src="scripts/clipboard.js" async="async"></script><script type="text/javascript" src="scripts/navigation-loader.js" async="async"></script><script type="text/javascript" src="scripts/platform-content-handler.js" async="async"></script><script type="text/javascript" src="scripts/main.js" async="async"></script>  </head>
  <body>
    <div id="container">
      <div id="leftColumn"><a href="index.html">
          <div id="logo"></div>
        </a>
        <div id="paneSearch"></div>
        <div id="sideMenu"></div>
      </div>
      <div id="main">
        <div id="leftToggler"><span class="icon-toggler"></span></div>
<script type="text/javascript" src="scripts/main.js"></script>        <div class="main-content" id="content" pageIds="KotlinKafka::////PointingToDeclaration//769193423">
          <div class="navigation-wrapper" id="navigation-wrapper">
            <div class="breadcrumbs"><a href="index.html">KotlinKafka</a></div>
            <div class="pull-right d-flex">
              <div id="searchBar"></div>
            </div>
          </div>
          <div class="cover ">
            <h1 class="cover"><span>Kotlin</span><wbr></wbr><span><span>Kafka</span></span></h1>
            <div class="platform-hinted UnderCoverText" data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":dokkaHtml/main"><!--- TEST_NAME ReadmeTest --><!--- TOC --><ul><li><p class="paragraph">#rationale</p></li><li><p class="paragraph">#goals</p></li><li><p class="paragraph">#example</p></li></ul><!--- END --><p class="paragraph">This project is still under development, andd started as a playground where I was playing around with Kafka in Kotlin and the Kafka SDK whilst reading the Kafka book Definite Guide from Confluent. https://www.confluent.io/resources/kafka-the-definitive-guide-v2/</p><h2 class=""> Rationale</h2><p class="paragraph">At the time of starting this repository I didn't find any bindings between Kafka SDK and Kotlin suspension. These operators should be implemented low-level, so they can guarantee correct cancellation support, and high optimised runtimes.</p><h2 class=""> Goals</h2><ul><li><p class="paragraph">Extensions to easily operate over the Kafka SDK with KotlinX Coroutines and <code>suspend</code>.</p></li><li><p class="paragraph">Flow based operators, so you can easily compose KotlinX Flow based Kafka programs</p></li><li><p class="paragraph">example for testing Kafka with Test Containers in Kotlin.</p></li></ul><h2 class=""> Example</h2><!--- INCLUDE
import arrow.fx.coroutines.Resource
import arrow.fx.coroutines.computations.resource
import arrow.fx.coroutines.fromAutoCloseable
import com.github.nomisRev.kafka.Acks
import com.github.nomisRev.kafka.AdminSettings
import com.github.nomisRev.kafka.AutoOffsetReset
import com.github.nomisRev.kafka.ConsumerSettings
import com.github.nomisRev.kafka.NothingSerializer
import com.github.nomisRev.kafka.ProducerSettings
import com.github.nomisRev.kafka.adminClient
import com.github.nomisRev.kafka.createTopic
import com.github.nomisRev.kafka.kafkaConsumer
import com.github.nomisRev.kafka.produce
import com.github.nomisRev.kafka.subscribeTo
import java.util.UUID
import kotlinx.coroutines.Dispatchers.Default
import kotlinx.coroutines.Dispatchers.IO
import kotlinx.coroutines.coroutineScope
import kotlinx.coroutines.flow.asFlow
import kotlinx.coroutines.flow.collect
import kotlinx.coroutines.flow.map
import kotlinx.coroutines.flow.take
import kotlinx.coroutines.launch
import kotlinx.coroutines.runBlocking
import kotlinx.coroutines.runInterruptible
import org.apache.kafka.clients.admin.NewTopic
import org.apache.kafka.clients.producer.ProducerRecord
import org.apache.kafka.common.serialization.StringDeserializer
import org.apache.kafka.common.serialization.StringSerializer
import org.testcontainers.containers.KafkaContainer
import org.testcontainers.utility.DockerImageName

fun kafkaContainer(
  fullImageName: String = "confluentinc/cp-kafka:6.2.1"
): Resource<KafkaContainer> = resource {
  val kafka =
    Resource.fromAutoCloseable { KafkaContainer(DockerImageName.parse(fullImageName)) }.bind()
  // start is an interruptible blocking Java method
  runInterruptible(IO) { kafka.start() }
  kafka
}
--><div class="sample-container"><code class="" theme="idea"><pre>fun main(): Unit =<br>  runBlocking(Default) {<br>    kafkaContainer().use { kafka -&gt;<br>      val topicName = &quot;test-topic&quot;<br>      val msgCount = 20<br><br>      adminClient(AdminSettings(kafka.bootstrapServers)).use { client -&gt;<br>        client.createTopic(NewTopic(topicName, 1, 1))<br>      }<br><br>      coroutineScope { // Run produces and consumer in a single scope<br>        launch { // Send 20 messages, and then close the producer<br>          val settings =<br>            ProducerSettings(<br>              kafka.bootstrapServers,<br>              NothingSerializer,<br>              StringSerializer(),<br>              Acks.All<br>            )<br>          (1..msgCount)<br>            .map { ProducerRecord&lt;Nothing, String&gt;(topicName, &quot;msg: $it&quot;) }<br>            .asFlow()<br>            .produce(settings)<br>            .collect(::println)<br>        }<br><br>        launch { // Consume 20 messages as a stream, and then close the consumer<br>          val settings =<br>            ConsumerSettings(<br>              kafka.bootstrapServers,<br>              StringDeserializer(),<br>              StringDeserializer(),<br>              groupId = UUID.randomUUID().toString(),<br>              autoOffsetReset = AutoOffsetReset.Earliest<br>            )<br>          kafkaConsumer(settings)<br>            .subscribeTo(topicName)<br>            .take(msgCount)<br>            .map { it.value() }<br>            .collect(::println)<br>        }<br>      }<br>    }<br>  }</pre></code></div><div class="sample-container"><code class="" theme="idea"><pre><p class="paragraph">You can get the full code guide/example/example-readme-01.kt.</p></pre></code></div><div class="sample-container"><code class="" theme="idea"><pre>test-topic-0@0<br>test-topic-0@1<br>test-topic-0@2<br>test-topic-0@3<br>test-topic-0@4<br>test-topic-0@5<br>test-topic-0@6<br>test-topic-0@7<br>test-topic-0@8<br>test-topic-0@9<br>test-topic-0@10<br>test-topic-0@11<br>test-topic-0@12<br>test-topic-0@13<br>test-topic-0@14<br>test-topic-0@15<br>test-topic-0@16<br>test-topic-0@17<br>test-topic-0@18<br>test-topic-0@19<br>msg: 1<br>msg: 2<br>msg: 3<br>msg: 4<br>msg: 5<br>msg: 6<br>msg: 7<br>msg: 8<br>msg: 9<br>msg: 10<br>msg: 11<br>msg: 12<br>msg: 13<br>msg: 14<br>msg: 15<br>msg: 16<br>msg: 17<br>msg: 18<br>msg: 19<br>msg: 20</pre></code></div><!--- TEST --></div></div>
          </div>
          <h2 class="">Packages</h2>
          <div class="table"><a data-name="-1022263899%2FPackages%2F769193423" anchor-label="com.github.nomisRev.kafka" id="-1022263899%2FPackages%2F769193423" data-filterable-set=":dokkaHtml/main"></a>
            <div class="table-row" data-filterable-current=":dokkaHtml/main" data-filterable-set=":dokkaHtml/main">
              <div>
                <div class="main-subrow ">
                  <div class=""><span class="inline-flex"><a href="-kotlin-kafka/com.github.nomisRev.kafka/index.html">com.github.nomisRev.kafka</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-1022263899%2FPackages%2F769193423"></span>
                        <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                      </span></span></div>
                  <div class="pull-right"></div>
                </div>
                <div></div>
              </div>
            </div>
          </div>
        </div>
        <div class="footer"><span class="go-to-top-icon"><a href="#content"></a></span><span>Â© 2021 Copyright</span><span class="pull-right"><span>Generated by </span><a href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span></div>
      </div>
    </div>
  </body>
</html>

